<div class="page-header">
  <h1 class ='text-center'>Reports</h1>
</div>
<div class="page-header col-xs-12">
  <div class = 'row'>

    <div class="form-group col-xs-12 col-sm-3">
      <h5>Report Type</h5>
      <div class="radio">
        <label>
          <input  ng-model='report.reportType'  type="radio" name="reportType" value='manager' ng-change="clearReport()">
          Jobs Manager Report
        </label>
      </div>
      <div class="radio">
        <label>
          <input  ng-model='report.reportType'  type="radio" name="reportType" value='worker' ng-change="clearReport()">
          Jobs by Worker Report
        </label>
      </div>
      <div class="radio">
        <label>
          <input ng-model='report.reportType'  type="radio" name="reportType" value='property' ng-change="clearReport()">
          Jobs by Property Report
        </label>
      </div>
    </div>

    <div class="form-group col-xs-12 col-sm-4" ng-show='report.reportType'>
      <h5>Pick Start-End Date</h5>
      <div class="col-xs-12">
        <label for="jobSearchStart" class="control-label">From</label>
          <input required ng-model="report.date.start" type="date" class="form-control" id="jobSearchStart"  format-date>
        </div>
        <div class="col-xs-12">
        <label for="jobSearchEnd" class='control-label'>To</label>
          <input required ng-model="report.date.end" type="date" class="form-control" id="jobSearchEnd" format-date>
      </div>
    </div>
    
    <div class='form-group col-xs-12 col-sm-4' ng-show ='report.reportType'>  
      <h5>Select Field</h5>
      <div class="form-group text-center" ng-if = 'report.reportType==="manager"'>
        <label for="reportManagerFilter" class="col-xs-2 control-label">Manager</label>
        <div>
          <select ng-model = 'report.manager' class="form-control" id='reportManagerFilter'>
            <option value = '{{admin._id}}' ng-repeat ='admin in admins'>
            {{admin.first}} {{admin.last}}
            </option>
          </select>
        </div>
      </div>
      <div class="form-group text-center" ng-if = 'report.reportType==="worker"'>
        <label for="reportWorkerFilter" class="col-xs-2 control-label">Worker</label>
        <div>
         <select  ng-model = 'report.worker' class="form-control" id='reportWorkerFilter'>
            <option value='{{worker._id}}' ng-repeat ='worker in workers'>
            {{worker.first}} {{worker.last}}
            </option>
          </select>
        </div>
      </div>
    
      <div class="form-group text-center" ng-if = 'report.reportType==="property"'>
        <label for="reportPropertyFilter" class="col-xs-2 control-label">Property</label>
        <div>
          <select ng-model = 'report.propertie' class="form-control" id='reportPropertyFilter'>
            <option  value = '{{property._id}}' ng-repeat ='property in properties'>
            {{property.name}}
            </option>
          </select>
        </div>
      </div><br>   
      <div class='col-xs-12'>
        <button class="btn btn-default center-block" type="button" ng-click='generateReport()' ng-disabled='!report.manager && !report.worker && !report.propertie'><i class="fa fa-plus-circle"></i> Generate Report</button>
      </div>
    </div><br>


  </div>
</div>
<div class="panel panel-default col-xs-12" ng-if ='report.reportType === "manager"' id="printableArea">
  <table class="table table-bordered table">
    <tr>
      <th>Property</th>
      <th>Apt#</th>   
      <th>Job</th>
      <th>PO #</th>
      <th>Invoice #</th>
      <th class='no-print'>Edit</th>
    </tr>
    <tr ng-repeat = 'job in report.jobs'>
      <td>
        <p>{{job.propertie.name}}</p>
        <p class='i-red' ng-if='!job.ready_review'><i class="fa fa-exclamation"></i> This job is not ready for review</p>
      </td>
      <td>{{job.unit}}</td>
      <td>
        <div class="table-responsive">
          <table class="table">
            <tr>
              <th>Service</th>
              <th>Date</th>
              <th>Worker</th>
              <th>Price</th>
              <th>Description</th>
            </tr>
            <tr ng-repeat = 'service in job.services'>
              <td>{{service.item}}</td>
              <td ng-class="{ 'date-error': service.date_assigned<=startDateCompare || service.date_assigned>=endDateCompare }">{{service.date_assigned|date:'MM/dd/yyyy'}}</td>
              <td>{{service.worker.first}} {{service.worker.last}}</td>
              <td>{{service.price}} $</td>
              <td>{{service.description}}</td>
            </tr>
            <tr>
              <td></td><td></td>
              <td>
                <div>
                  <p>Job Total Price: </p>
                  <p ng-if ='job.totalCost'>Job Total Cost: </p>            
                </div>                
              </td>
              <td>
                <div>
                  <p>{{job.totalPrice}} $</p>
                  <p ng-if ='job.totalCost'>{{job.totalCost}} $</p>
                </div>
              </td>
              <td></td>
            </tr>
          </table>
        </div>                
      </td>
      <td>{{job.poNumber}}</td>
      <td>{{job.invoiceNumber}}</td>
      <td class= 'no-print'><a class="btn btn-info" ui-sref = 'main_private.jobs_edit({id:job._id})'><i class="fa fa-pencil"></i> Edit</a></td>
    </tr>
  </table>
</div>

<div class="panel panel-default col-xs-12" ng-if ='report.reportType === "worker"' id="printableArea">
<table class="table table-bordered table">
    <tr>
      <th>Property</th>
      <th>Apt#</th>   
      <th>Job</th> 
    </tr>
    <tr ng-repeat = 'job in report.jobs'>
      <td>{{job.propertie.name}}</td>
      <td>{{job.unit}}</td>
      <td>
        <div class="table-responsive">
          <table class="table">
            <tr>
              <th>Service</th>
              <th>Date</th>
              <th>Worker</th>
              <th>Price</th>
            </tr>
            <tr ng-repeat = 'service in job.services'>
              <td ng-if ='service.worker._id === report.worker && service.date_assigned>=startDateCompare && service.date_assigned<=endDateCompare'>{{service.item}}</td>
              <td ng-if ='service.worker._id === report.worker && service.date_assigned>=startDateCompare && service.date_assigned<=endDateCompare'>{{service.date_assigned|date:'MM/dd/yyyy'}}</td>
              <td ng-if ='service.worker._id === report.worker && service.date_assigned>=startDateCompare && service.date_assigned<=endDateCompare'>{{service.worker.first}} {{service.worker.last}}</td>
              <td ng-if ='service.worker._id === report.worker && service.date_assigned>=startDateCompare && service.date_assigned<=endDateCompare'>{{service.price}} $</td>
            </tr>
          </table>
        </div>                
      </td>
    </tr>
  </table>
</div>

<div class="panel panel-default col-xs-12" ng-if ='report.reportType === "property"' id="printableArea">
  <table class="table table-bordered table">
    <tr>
      <th>Apt#</th>   
      <th>Job</th>
      <th>PO #</th>
      <th>Invoice #</th>
    </tr>
    <tr class ='outer-table' ng-repeat = 'job in report.jobs'>
      <td>{{job.unit}}</td>
      <td>
        <div class="table-responsive">
          <table class="table">
            <tr>
              <th>Service</th>
              <th>Date</th>
              <th>Worker</th>
              <th>Price</th>
              <th>Description</th>
            </tr>
            <tr ng-repeat = 'service in job.services'>
              <td>{{service.item}}</td>
              <td ng-class="{ 'date-error': service.date_assigned<=startDateCompare || service.date_assigned>=endDateCompare }">{{service.date_assigned|date:'MM/dd/yyyy'}}</td>
              <td>{{service.worker.first}} {{service.worker.last}}</td>
              <td>{{service.price}} $</td>
              <td>{{service.description}}</td>
            </tr>
            <tr>
              <td></td><td></td>
              <td>
                <div>
                  <p>Job Total Price: </p>
                  <p ng-if ='job.totalCost'>Job Total Cost: </p>            
                </div>                
              </td>
              <td>
                <div>
                  <p>{{job.totalPrice}} $</p>
                  <p ng-if ='job.totalCost'>{{job.totalCost}} $</p>
                </div>
              </td>
              <td></td>
            </tr>
          </table>
        </div>                
      </td>
      <td>{{job.poNumber}}</td>
      <td>{{job.invoiceNumber}}</td>
    </tr>
  </table>
</div>
<div>
  <button ng-if='report.jobs.length>0' class="btn btn-default btn-lg center-block" ng-click='printHTML()'><i class="fa fa-print"></i> Print</button><br><br><br>
</div>
